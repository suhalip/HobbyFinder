<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Hobby Finder Inc.</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.js"></script>
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css" type="text/css">
    <link rel="stylesheet" href="style.css">
    <script src="autocomplete.js"></script>
    <script src="background.js"></script>
    <style>
    </style>
</head>
<body>
    <header class="header">
        <h1>Hobby Finder Inc.</h1>
    </header>
    <div class="container">
        <form id="search_form" action="/search-hobbies" method="get" class="search-bar" >
            <div id="suggestions-dropdown" style="display:none;"></div>
            <input type="text" placeholder="Search hobbies..." name="q" />
            <button type="submit"><img src="images/search.png" /></button>
        </form>
        <br>
        <form action="/search-hobbies" method="post" class="search-bar">
            <input form="search_form" type="text" id="my-location-input" placeholder="Location" name="l" />
            <input form="search_form" type="date" placeholder="MM/DD/YY" name="date" />
        </form>
        <div id="loading-bar-container">
    <div id="loading-bar"></div>
</div>
    </div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchForm = document.getElementById('search_form');
    const suggestionsDropdown = document.getElementById('suggestions-dropdown');

    searchForm.addEventListener('submit', function(e) {
        e.preventDefault(); // Prevent the default form submission

        // Fetch user inputs from the form
        const query = document.querySelector('input[name="q"]').value;
        const location = document.querySelector('input[name="l"]').value;
        const date = document.querySelector('input[name="date"]').value;

        suggestionsDropdown.style.display = 'none';
        showLoadingBar();
        fetchDataAndRedirect(query, location, date);
    });
});

function showLoadingBar() {
    const loadingBarContainer = document.getElementById('loading-bar-container');
    const loadingBar = document.getElementById('loading-bar');

    loadingBarContainer.style.display = 'block'; // Ensure the container is visible
    let progress = 0;
    const interval = setInterval(() => {
        progress += 2; // Increase progress
        loadingBar.style.width = `${progress}%`; // Update loading bar width
        if (progress >= 100) clearInterval(interval);
    }, 100);
}

function fetchDataAndRedirect(query, location, date) {
    fetch(`/search-hobbies?q=${encodeURIComponent(query)}&l=${encodeURIComponent(location)}&date=${encodeURIComponent(date)}`)
        .then(response => response.json())
        .then(data => {
            setTimeout(() => { // Give a slight delay for visual completion
                localStorage.setItem('formattedData', JSON.stringify(data));
                window.location.href = 'ResultsPage.html'; // Redirect to the results page
            }, 1); // Redirect after a 1-second delay
        })
        .catch(error => {
            console.error('Error:', error);
            const loadingBarContainer = document.getElementById('loading-bar-container');
            loadingBarContainer.style.display = 'none'; // Hide the loading bar container
        });
}
</script>

</body>
</html>
