<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Hobby Finder Inc.</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.js"></script>
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css" type="text/css">
    <link rel="stylesheet" href="style.css">
    <script src="autocomplete.js"></script>
    <script src="background.js"></script>
    <style>
    </style>
</head>
<body>
    <header class="header">
        <h1>Hobby Finder Inc.</h1>
    </header>
    <div class="container">
        <form id="search_form" action="/search-hobbies" method="get" class="search-bar" >
            <div id="suggestions-dropdown"></div>
            <input type="text" placeholder="Search hobbies..." name="q" />
            <button type="submit"><img src="images/search.png" /></button>
        </form>
        <br>
        <form action="/search-hobbies" method="post" class="search-bar">
            <input form="search_form" type="text" id="my-location-input" placeholder="Location" name="l" />
            <input form="search_form" type="date" placeholder="MM/DD/YY" name="date" />
        </form>
        <div id="loading-bar-container">
            <div id="loading-bar"></div>
            </div>
        </div>
        <div id="mascot" class="mascot-style">
    <img src="images/mascot.png" alt="Friendly Mascot" />
        </div>
    <div id="location-mascot" class="mascot-style" style="display:none;">
        <img src="images/Plane.png" alt="Location Mascot" />
    </div>
    </div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const searchForm = document.getElementById('search_form');
        const suggestionsDropdown = document.getElementById('suggestions-dropdown');
        const mascot = document.getElementById('mascot'); // Get the mascot element
        const locationInput = document.getElementById('my-location-input'); // Get the location input element
        const locationMascot = document.getElementById('location-mascot');
        searchForm.querySelector('input[name="q"]').addEventListener('focusin', function() {
            mascot.style.bottom = '20px'; // Adjust as needed
            mascot.style.animation = 'bounce 1s infinite';
        });
        searchForm.querySelector('input[name="q"]').addEventListener('focusout', function() {
            mascot.style.bottom = '-120px';
            mascot.style.animation = 'none';
        });
        locationInput.addEventListener('focusin', function() {
        locationMascot.style.display = 'block'; // Show the location mascot
        locationMascot.style.bottom = '10px'; // Slightly raise the mascot from the bottom
        locationMascot.style.animation = 'bounce 1s infinite';
        });
        locationInput.addEventListener('focusout', function() {
        locationMascot.style.display = 'none'; // Hide the location mascot
        locationMascot.style.bottom = '-150px'; // Change this value to match the height of your image
        locationMascot.style.animation = 'none';
    });
        searchForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const query = document.querySelector('input[name="q"]').value;
            const location = document.querySelector('input[name="l"]').value;
            const date = document.querySelector('input[name="date"]').value;
            suggestionsDropdown.style.display = 'none';
            showLoadingBar();
            fetchDataAndRedirect(query, location, date);
        });
    });
    function showLoadingBar() {
        const loadingBarContainer = document.getElementById('loading-bar-container');
        const loadingBar = document.getElementById('loading-bar');

        loadingBarContainer.style.display = 'block'; // Ensure the container is visible
        let progress = 0;
        const interval = setInterval(() => {
            progress += 2; // Increase progress
            loadingBar.style.width = `${progress}%`; // Update loading bar width
            if (progress >= 100) clearInterval(interval);
        }, 100);
    }

    function fetchDataAndRedirect(query, location, date) {
    fetch(`/search-hobbies?q=${encodeURIComponent(query)}&l=${encodeURIComponent(location)}&date=${encodeURIComponent(date)}`)
        .then(response => response.json())
        .then(data => {
            setTimeout(() => { // Give a slight delay for visual completion
                localStorage.setItem('formattedData', JSON.stringify(data));
                localStorage.setItem('location', location); // Store the location entered by the user
                window.location.href = 'ResultsPage.html'; // Redirect to the results page
            }, 5); // Redirect after a delay
        })
    .catch(error => {
        console.error('Error:', error);
        const loadingBarContainer = document.getElementById('loading-bar-container');
        loadingBarContainer.style.display = 'none'; // Hide the loading bar container
        }
    );
}

</script>
</body>
</html>
