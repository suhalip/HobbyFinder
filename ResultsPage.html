<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Results</title>
    <link rel="stylesheet" href="ResultPgStyle.css">

    <script src="background.js"></script>
</head>
<body>
<div class="container">
    <header class="header">
        <h1>Events & Things to do in<span class="blue-text"> New Hampshire</span></h1>
        <div class="tab">
    <button class="tablinks" onclick="openTab(event, 'Events')">Events</button>
    <button class="tablinks" onclick="openTab(event, 'Suggestions')">Suggestions</button>
</div>
    </header>
    <div class="resultspage-container">
        <div id="favorite-list" class="favorite-list">
            <h3>Liked</h3>
            <ul id="favorites"></ul>
        </div>
        <div id="EventsTab" class="tabcontent">
            <div id="events" class="events-container">
                <h2>Events</h2>
                <div id="results" class="results-container"></div>
            </div>
        </div>
        <div id="SuggestionsTab" class="tabcontent">
            <div id="suggestions" class="results-container">
                <h2>Suggestions</h2>
            </div>
        </div>
    </div>
</div>

<script>
    async function getData() {
    const storedData = localStorage.getItem('formattedData');
    const data = JSON.parse(storedData);

    if (!data) {
        console.error('No data found');
        return;
    }

    const eventsContainer = document.getElementById('results');
    eventsContainer.innerHTML = '';

    data.events.forEach(event => {
        const eventElement = document.createElement('div');
        eventElement.classList.add('tile');
        eventElement.innerHTML = `
            <img src="${event.imageUrl}" alt="Event image" class="event-image">
            <div class="event-info">
                <h3 class="event-title">${event.name}</h3>
                <p class="event-date">Date: ${event.date} | Time: ${event.time}</p>
                <p class="event-location">Location: ${event.location}</p>
                <a href="${event.url}" class="event-link" target="_blank">Event Details</a>
                <button class="add-to-favorites" onclick="addToFavorites(this)"></button>
            </div>
        `;
        eventsContainer.appendChild(eventElement);
    });

    updateFavoriteButtons();
}


    function displaySuggestions() {
    const storedData = localStorage.getItem('formattedData');
    if (!storedData) {
        console.error('No data found in localStorage.');
        return;
    }

    const data = JSON.parse(storedData);
    if (!data.suggestions || data.suggestions.length === 0) {
        console.log('No suggestions available.');
        return;
    }
    const validSuggestions = data.suggestions.filter(suggestion => suggestion.trim() !== '');
    const suggestionsContainer = document.getElementById('suggestions');
    suggestionsContainer.innerHTML = '';

    validSuggestions.forEach((suggestion, index) => {
        const tile = document.createElement('div');
        tile.classList.add('result-item');

        tile.innerHTML = `
            <p>${suggestion.trim()}</p>
            <button class="add-to-favorites" onclick="addToFavorites(this)"></button>
        `;
        suggestionsContainer.appendChild(tile);
    });
        updateFavoriteButtons();
}

    function saveFavorites() {
        const favoriteItems = document.querySelectorAll('#favorites li');
        const favorites = [];
        favoriteItems.forEach(item => favorites.push(item.textContent));
        sessionStorage.setItem('favorites', JSON.stringify(favorites));
    }

function loadFavorites() {
    const favorites = JSON.parse(sessionStorage.getItem('favorites'));
    if (favorites) {
        favorites.forEach(favorite => {
            const listItem = document.createElement('li');
            listItem.textContent = favorite;
            document.getElementById('favorites').appendChild(listItem);
        });
    }
}
function addToFavorites(button) {
    let textContent;

    const eventTitleElement = button.parentNode.querySelector('.event-title');
    textContent = eventTitleElement ? eventTitleElement.textContent : button.previousElementSibling.textContent.trim();

    textContent = textContent.replace(/^\d+\.\s*([A-Za-z\s]+):.*$/, '$1').trim();

    const favoritesList = document.getElementById('favorites');
    let isDuplicate = false;
    favoritesList.querySelectorAll('li').forEach((li) => {
        if (li.textContent.trim() === textContent.trim()) {
            isDuplicate = true;
        }
    });
    if (!isDuplicate) {
        const listItem = document.createElement('li');
        listItem.textContent = textContent;
        favoritesList.appendChild(listItem);
        saveFavorites(); // Save the updated favorites list
    }
    button.disabled = true;
    sessionStorage.setItem(textContent, 'disabled');
}

function updateFavoriteButtons() {
    const buttons = document.querySelectorAll('.add-to-favorites');
    buttons.forEach(button => {
        const eventInfoElement = button.parentNode;
        const eventTitleElement = eventInfoElement.querySelector('.event-title');
        const eventTitle = eventTitleElement ? eventTitleElement.textContent.trim() : '';

        if (sessionStorage.getItem(eventTitle) === 'disabled') {
            button.disabled = true;
        } else {
            button.disabled = false;
        }
    });
}

function openTab(evt, tabName) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(tabName + "Tab").style.display = "block";
    evt.currentTarget.className += " active";

    if (tabName === 'Events') {
        getData();
    } else if (tabName === 'Suggestions') {
        displaySuggestions();
    }
    updateFavoriteButtons();
}

   document.addEventListener('DOMContentLoaded', function() {
        loadFavorites();
        document.querySelector('.tablinks').click();

        const buttons = document.querySelectorAll('.add-to-favorites');
        buttons.forEach(button => {
        const eventInfoElement = button.parentNode;
        const eventTitleElement = eventInfoElement.querySelector('.event-title');
        const eventTitle = eventTitleElement ? eventTitleElement.textContent.trim() : '';

        // Disable button if it was previously disabled in the session
        if (sessionStorage.getItem(eventTitle) === 'disabled') {
            button.disabled = true;
        }
        const location = localStorage.getItem('location');
    if(location) {
        const locationElement = document.querySelector('.header h1 .blue-text');
        locationElement.textContent = ` ${location}`; // Sets the location text in the <h1>
    }
    });
   });



</script>

</body>
</html>
